#coding:utf8
# Create your views here.
import hashlib

from django.shortcuts import render_to_response
from django.http import HttpResponseRedirect
from django.core.exceptions import ObjectDoesNotExist

from cgadmin.models import User,Post, Team


def reg(req):
    if req.method == "POST":
        username = req.POST.get('username',None)
        password = req.POST.get('password',None)
        headimg = req.FILES.get('headimg')
        if username and password:
            password = hashlib.sha1(password+username).hexdigest()
            User.objects.create(username=username,password=password,headimg=headimg)
             
            return HttpResponseRedirect('/login/')
    else:
        pass
    return render_to_response('reg.html',{})

def login(req):
    if req.method == "POST":
        username = req.POST.get('username',None)
        password = req.POST.get('password',None)
        if username and password:
            password = hashlib.sha1(password+username).hexdigest()
            try:
                user = User.objects.get(username=username,password=password)
                return HttpResponseRedirect('/?uid=%s' %user.id)
            except ObjectDoesNotExist:
                return HttpResponseRedirect('/login/')
    else:
        pass
    return render_to_response('login.html',{})

def index(req):
    uid = req.GET.get('uid',None)
    if uid:
        user = User.objects.get(id=uid)
        return render_to_response('index.html', {'user':user})
    else:
        return HttpResponseRedirect('/reg/')


def plist(req):
    new_list = Post.objects.all()
    return render_to_response('plist.html',{'new_list':new_list})


def show_plist(req):
    nid = req.GET.get('nid')
    new = Post.objects.get(id=nid)
    return render_to_response('show_plist.html',{'new':new})

def team(req):
    teamlist = Uteam.objects.all()


def pinglun(req):
    new = Post.objects.get(id=nid)
    return render_to_response("pinglun.html",{'new':new})

